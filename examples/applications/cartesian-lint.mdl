#IMPORT("examples/minidoop.in", 'Program).
IMPORT("p/t3.mdl", 'Program).

analyze ('Program) {

  VarIsFiltered($p, v) :-
          [ ... :- ..., $p(...), ..., $p2(..., $y, ...) . ],
	  NOT(EQ($p, $p2)),
	  ID($y, v).
  VarIsFiltered($p, v) :-
          [ ... :- ..., $p(...), ..., NOT($p2(..., $y, ...)) . ],
	  ID($y, v).

  VAL($x) :- INT($x, val).
  VAL($x) :- STR($x, val).
  PredicateIsFiltered($p) :-
          [ ... :- ..., $p(..., $x, ...), ... . ],
	  VAL($x).
  PredicateIsFiltered($p) :-
          [ ... :- ..., $p(..., $x, ..., $y, ...), ... . ],
          ID($x, v), NOT(EQ($x, $y)), ID($y, v).
  PredicateIsFiltered($p) :-
          [ ... :- ..., $p(..., $x, ...), .... ],
	  ID($x, v),
          VarIsFiltered($p, v).

  OutputIsNotProjectionOf(p_name, $i, q_name, $k) :-
      [ ..., $p(..., $i:$x, ...), ... :- ..., $q(..., $k:$y, ...), ... .],
      ID($p, p_name),
      ID($q, q_name),
      ID($x, v),
      NOT(ID($y, v)).

  OutputIsNotProjectionOf(p_name, $i, q_name, $k) :-
      [ ..., $p(..., $i:$x, ...), ... :- ..., $q(..., $k:$y, ...), ... .],
      ID($p, p_name),
      ID($q, q_name),
      PredicateIsFiltered($q).

  OutputIsProjection(p_name, $i, q_name, $k) :-
      [ ..., $p(..., $i:$x, ...), ... :- ..., $q(..., $k:$y, ...), ... .],
      ID($p, p_name),
      ID($q, q_name),
      ID($x, v),
      ID($y, v),
      NOT(OutputIsNotProjectionOf(p_name, $i, q_name, $k)).

  CartesianProjectionWarning(p_name, $i, $j) :-
      [ ..., $p(..., $i:$x, ..., $j:$y, ...), ... :- ... .],
      ID($p, p_name),
      NOT(EQ($i, $j)),
      NOT(VAL($x)),
      NOT(VAL($y)),
      OutputIsProjection(p_name, $i, q_name, $ik),
      OutputIsProjection(p_name, $j, r_name, $jk),
      NOT(EQ(q_name, r_name)).

  ProjectionWarning(p_name, $i, src) :-
      [ ..., $p(..., $i:$x, ...), ... :- ... .],
      ID($p, p_name),
      NOT(VAL($x)),
      SRC($i, src),
      OutputIsProjection(p_name, $i, q_name, $ik).
}

OUTPUT('CartesianProjectionWarning).
OUTPUT('ProjectionWarning).
